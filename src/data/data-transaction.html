<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="data-transaction">
    <script>
        (function () {
            // Import libraries
            const Tx = webpack.EthereumTx
            const Buffer = webpack.Buffer.Buffer
            const _web3 = window.web3Local
            const sha3 = webpack.sha3
            const ipfs = window.ipfs

            const {
                swtToken,
                hashtagList,
                simpleDeal
            } = contractsData;
            
            async function tokenTxAsync({
                sender,
                receiverAddress,
                weiAmount,
                tokenContractAddress }) {
                const tokenContract = new webpack.Contract(
                    swtToken.abi,
                    tokenContractAddress);
                let rawTokenTx = tokenContract.methods.transfer(
                    receiverAddress,
                    weiAmount
                ).encodeABI();

                // 2. Get user's nonce
                const nonce = await _web3.eth.getTransactionCount(sender.address)

                // 3. Generate tx object, sign and serialize
                const tx = new Tx({
                    nonce: _web3.utils.toHex(nonce),
                    from: sender.address,
                    gasPrice: 1000000000,
                    gasLimit: 3000000,
                    to: tokenContractAddress,
                    data: rawTokenTx,
                    chainId: 42,
                });
                tx.sign(new Buffer(sender.privateKey, 'hex'));
                const serializedTx = tx.serialize();
                return serializedTx
            }

            class DataTransaction extends Polymer.Element {
                static get is() {
                    return 'data-transaction';
                }
                tokenTx(args) {
                    return tokenTxAsync(args)
                }
            }
            window.customElements.define(DataTransaction.is, DataTransaction);


        })();

    </script>
</dom-module>